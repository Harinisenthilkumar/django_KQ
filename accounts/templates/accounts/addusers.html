{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add User</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="{% static 'accounts/css/addusers.css' %}">
    <style>
        .error-message {
            color: red;
            font-size: 0.8em;
            margin-top: 5px;
        }
    </style>
</head>
<body>
        <div class="sidebar">
        <div class="logo-section">
            <div class="logo-circle">
                <img src="{% static 'accounts/images/l1.svg' %}" alt="Logo" class="logo">
            </div>
            <img src="{% static 'accounts/images/filter_whitebg.svg' %}" alt="Filter" class="filter-icon">
        </div>
        <nav class="nav-links">
            <ul>
                <li><img src="{% static 'accounts/images/dashboard_whitebg.svg' %}" class="icon-img"> Dashboard</li>
                <li><img src="{% static 'accounts/images/question_bank_whitebg.svg' %}" class="icon-img"> Question Bank</li>
                <li class="active"><img src="{% static 'accounts/images/users_whitebg.svg' %}" class="icon-img"> Users</li>
                <li><img src="{% static 'accounts/images/blueprint_whitebg.svg' %}" class="icon-img"> Blueprint</li>
                <li><img src="{% static 'accounts/images/assessment_whitebg.svg' %}" class="icon-img"> Assessment</li>
                <li><img src="{% static 'accounts/images/assignment_whitebg.svg' %}" class="icon-img"> Assignment</li>
                <li><img src="{% static 'accounts/images/reports_whitebg.svg' %}" class="icon-img"> Reports</li>
                <li><img src="{% static 'accounts/images/logout_whitebg.svg' %}" class="icon-img"> Logout</li>
            </ul>
        </nav>
        <div class="sidebar-image">
            <img src="{% static 'accounts/images/Rectangle 14.png' %}" alt="Sidebar Banner">
        </div>
    </div>
    <main class="main-content-container">
        <div class="add-user-content">
            <form id="addUserForm" method="post">

                {% csrf_token %}
                <div class="form-header">
                    <h2>Add User</h2>

                </div>
                <div>
                    <label for="userrole" class="block text-gray-700 text-sm font-bold mb-2">User Role <span style="color: #E80000;">*</span></label>
                    <select id="userrole" name="userrole" class="user" required>

                        <option value="candidate">Candidate</option>
                        <option value="sme">SME</option>
                        <option value="examiner">Examiner</option>
                        <option value="admin">Admin</option>
                    </select>
                    <p id="userroleError" class="text-red-500 text-xs italic"></p> </div>
                <div class="two-column-form">
                    <div class="form-group">
                        <label for="username">User Name <span style="color: #E80000;">*</span></label>
                        <input type="text" id="username" name="username" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="employeeId">Employee ID <span style="color: #E80000;">*</span></label>
                        <input type="text" id="employeeId" name="employeeId" class="form-control" required>
                    </div>
                </div>
                <div class="two-column-form">
                    <div class="form-group">
                        <label for="department">Department <span style="color: #E80000;">*</span></label>
                        <div class="input-group">
                            <select id="department" name="department" class="form-control" required>
                                <option value="" disabled selected>Select</option>
                                <option value="tech">Tech</option>
                                <option value="quality_check">Quality Check</option>
                                <option value="media">Media</option>
                                <option value="business_development">Business Development</option>
                            </select>
                            <div class="input-group-icon add-icon">
                                <img src="{% static 'accounts/images/add.svg' %}" alt="Add">
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="designation">Designation <span style="color: #E80000;">*</span></label>
                        <div class="input-group">
                            <select id="designation" name="designation" class="form-control" required>
                                <option value="" disabled selected>Select</option>
                                <option value="developer">Developer</option>
                                <option value="qc_analysis">QC Analysis </option>
                                <option value="business_development_executive">Business Development Executive </option>
                            </select>
                            <div class="input-group-icon add-icon">
                                <img src="{% static 'accounts/images/add.svg' %}" alt="Add">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="two-column-form">
                    <div class="form-group">
                        <label for="email">Email ID <span style="color: #E80000;">*</span></label>
                        <input type="email" id="email" name="email" class="form-control" required onblur="validateEmail()">
                        <p id="emailError" class="error-message"></p>
                    </div>
                    <div class="form-group">
                        <label for="mobile-number">Mobile Number <span style="color: #E80000;">*</span></label>
                        <input type="tel" id="mobile-number" name="mobile-number" class="form-control" required onblur="validateMobileNumber()">
                        <p id="mobileNumberError" class="error-message"></p>
                    </div>
                </div>
                <div class="two-column-form">
                    <div class="form-group">
                        <label>Is Active <span style="color: #E80000;">*</span></label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="is-active" class="radio-input" value="yes" required> Yes
                            </label>
                            <label>
                                <input type="radio" name="is-active" class="radio-input" value="no" required> No
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="remarks">Remarks</label>
                        <input type="text" id="remarks" name="remarks" class="form-control" >
                    </div>
                </div>
                <div class="two-column-form">
                    <div class="form-group">
                        <label>Is Account Locked <span>*</span></label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="is-locked" class="radio-input" value="yes" required> Yes
                            </label>
                            <label>
                                <input type="radio" name="is-locked" class="radio-input" value="no" required> No
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="remarks">Remarks</label>
                        <input type="text" id="remarks" name="remarks" class="form-control">
                    </div>
                </div>
                <div class="form-footer">
                    <button type="submit" id="saveButton" class="btn btn-primary">Save</button>

                    <button type="button" class="btn btn-secondary">Cancel</button>
                </div>
            </form>
        </div>
    </main>
</div>
{% comment %} 
<script>
    document.getElementById("saveButton").addEventListener("click", function (e) {
      e.preventDefault();
  
      if (!validateForm()) {
        return; // Don't submit if form is invalid
      }
  
      const data = {
        userrole: document.getElementById("userrole").value,
        username: document.getElementById("username").value,
        employeeId: document.getElementById("employeeId").value,
        department: document.getElementById("department").value,
        designation: document.getElementById("designation").value,
        email: document.getElementById("email").value,
        mobile: document.getElementById("mobile-number").value,
        is_active: document.querySelector('input[name="is-active"]:checked')?.value,
        remarks: document.getElementById("remarks").value,
        is_locked: document.querySelector('input[name="is-locked"]:checked')?.value,
      };
  
      fetch("http://127.0.0.1:8000/api/users/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          // Include Authorization if needed
        },
        body: JSON.stringify(data),
      })
        .then((res) => {
          if (!res.ok) {
            throw new Error("Failed to save user");
          }
          return res.json();
        })
        .then((response) => {
          alert("User added successfully!");
          window.location.href = "dashboard.html";
        })
        .catch((error) => {
          alert("An error occurred: " + error.message);
        });
    });
  </script> {% endcomment %}
  




  <script>
   

    // Basic email validation
    function validateEmail() {
      const emailInput = document.getElementById('email');
      const emailError = document.getElementById('emailError');
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(emailInput.value)) {
        emailError.textContent = 'Please enter a valid email address.';
        return false;
      } else {
        emailError.textContent = '';
        return true;
      }
    }

    // Basic mobile number validation (you might need a more specific pattern)
    function validateMobileNumber() {
      const mobileInput = document.getElementById('mobile-number');
      const mobileError = document.getElementById('mobileNumberError');
      const mobileRegex = /^[0-9]{10}$/; // Example: 10 digits
      if (!mobileRegex.test(mobileInput.value)) {
        mobileError.textContent = 'Please enter a valid 10-digit mobile number.';
        return false;
      } else {
        mobileError.textContent = '';
        return true;
      }
    }

    function validateForm() {
      return validateEmail() && validateMobileNumber() && document.getElementById("addUserForm").checkValidity();
    }

    document.getElementById("saveButton").addEventListener("click", function (e) {
        e.preventDefault();
  
        // Basic form validation (you might want more robust validation)
        if (!document.getElementById("addUserForm").checkValidity()) {
          document.getElementById("addUserForm").reportValidity();
          return;
        }
  
        const data = {
           
          userRole: document.getElementById("userrole").value,
          username: document.getElementById("username").value,     
          employeeId: document.getElementById("employeeId").value,
          department: document.getElementById("department").value,
          designation: document.getElementById("designation").value,
          emailId: document.getElementById("email").value,
          mobileNumber: document.getElementById("mobile-number").value,
          isActive: document.querySelector('input[name="is-active"]:checked')?.value === "yes",
          remarks: document.getElementById("remarks").value,
          isAccountLocked: document.querySelector('input[name="is-locked"]:checked')?.value === "yes",
          password: "Default@123" // ✅ send a password always because Django needs it!
      };
  
        fetch("http://127.0.0.1:8000/accounts/create_user", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            // Include Authorization if needed
          },
          body: JSON.stringify(data),
        })
          .then((res) => {
            if (!res.ok) {
              return res.json().then(err => {
                throw new Error(err.message || "Failed to save user");
              });
            }
            return res.json();
          })
          .then((response) => {
            alert("User added successfully!");
            window.location.href = "{% url 'dashboard' %}"; 
          })
          .catch((error) => {
            alert("An error occurred: " + error.message);
          });
      });
  </script>
</body>
</html>